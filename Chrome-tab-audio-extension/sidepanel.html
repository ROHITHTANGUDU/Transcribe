
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Active Tab Audio Recorder (Chunks + Transcription)</title>
  <meta http-equiv="Content-Security-Policy" content="script-src 'self'; object-src 'self'">
  <style>
    body { 
      font-family: system-ui, sans-serif; 
      margin: 0; 
      padding: 12px; 
      width: 380px; 
    }
    h1 { 
      font-size: 1.05rem; 
      margin: 0 0 .5rem; 
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    #heading-left { display: inline-flex; align-items: center; gap: 6px; }
    #heading-right { display: inline-flex; align-items: center; gap: 8px; }
    label { 
      display: block; 
      font-size: .9rem; 
      margin-top: .5rem; 
    }
    input[type="number"] { 
      width: 100%; 
      padding: .4rem; 
      box-sizing: border-box; 
    }
    .row { 
      display: flex; 
      align-items: center; 
      gap: .5rem; 
      margin-top: .6rem; 
    }
    button { 
      padding: .5rem .9rem; 
      cursor: pointer;
    }
    #status { 
      margin: .6rem 0; 
      min-height: 1.2em; 
      font-size: 0.9rem;
      color: #444;
    }
    audio { 
      width: 100%; 
      margin-top: .5rem; 
    }
    ul#chunkList { 
      list-style: none; 
      padding-left: 0; 
      margin: .5rem 0 0 0; 
    }
    ul#chunkList li { 
      margin: .25rem 0; 
      font-size: .9rem; 
    }
    code { 
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; 
      color: #666;
    }
    #download {
      display: inline-block;
      margin-top: 0.5rem;
      color: #0066cc;
      text-decoration: none;
    }
    #transcription-container {
      margin-top: 1rem;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ddd;
      padding: 0.5rem;
      border-radius: 4px;
      background: #fff;
    }
    #transcription-container h3 {
      margin-top: 0;
      font-size: 1rem;
      color: #333;
    }
    #transcription {
      white-space: pre-wrap;
      font-size: 0.9rem;
      line-height: 1.4;
    }
    .transcription-item {
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #eee;
    }
    .timestamp {
      color: #666;
      font-size: 0.8rem;
    }
    .transcription-text {
      margin: 0.2rem 0 0 0;
    }

    /* Health UI near heading */
    .health-wrap { display:inline-flex; align-items:center; gap:8px; }
    .health-btn { font-size:12px; padding:6px 10px; border:1px solid #e5e7eb; background:#f9fafb; border-radius:6px; cursor:pointer; }
    .health-btn:hover { background:#f3f4f6; }
    .health-led { width:10px; height:10px; border-radius:999px; border:1px solid #d1d5db; box-shadow: inset 0 0 2px rgba(0,0,0,.15); background:#e5e7eb; }
  </style>
</head>
<body>
  <h1 id="appHeading">
    <span id="heading-left">Active Tab Audio Recorder (Chunks + Auto-Transcription)</span>
    <span id="heading-right" class="health-wrap">
      <button id="healthRefresh" class="health-btn" title="Refresh health">Refresh</button>
      <span id="healthDot" class="health-led" title="Health status"></span>
    </span>
  </h1>

  <label>
    Chunk size (seconds)
    <input id="chunkSecs" type="number" min="2" max="120" step="1" value="10" />
  </label>

  <div class="row">
    <button id="start">Start Recording</button>
    <button id="stop" disabled>Stop Recording</button>
    <select id="modeSelect">
      <option value="chunked" selected>Chunked (HTTP)</option>
      <!-- <option value="live">Live (WebSocket)</option> -->
    </select>
  </div>

  <div id="status">Ready to record</div>

  <audio id="playback" controls></audio>
  <a id="download" download style="display:none">Download full session</a>

  <h3 style="margin:.6rem 0 .25rem">Audio Chunks</h3>
  <ul id="chunkList"></ul>

  <script src="sidepanel.js"></script>
</body>
</html>
